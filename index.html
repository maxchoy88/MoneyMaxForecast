import React, { useState, useMemo } from 'react';
import { 
  AreaChart, Area, XAxis, YAxis, CartesianGrid, Tooltip, ResponsiveContainer, Line
} from 'recharts';
import { 
  TrendingUp, Search, Activity, ArrowUpRight, ArrowDownRight, 
  ShieldCheck, Zap, BarChart3, MessageSquare, Target, Filter, ChevronRight, LayoutGrid
} from 'lucide-react';

// æ‰©å±•åçš„é©¬è‚¡æ•°æ®æ± 
const STOCKS = [
  { id: '1', code: '1155', name: 'Maybank', price: 10.58, change: 0.04, sector: 'é‡‘è' },
  { id: '2', code: '1295', name: 'Public Bank', price: 4.48, change: -0.02, sector: 'é‡‘è' },
  { id: '3', code: '1023', name: 'CIMB', price: 8.20, change: 0.15, sector: 'é‡‘è' },
  { id: '4', code: '5347', name: 'Tenaga', price: 14.30, change: 0.12, sector: 'å…¬ç”¨äº‹ä¸š' },
  { id: '5', code: '5225', name: 'IHH', price: 7.20, change: 0.02, sector: 'åŒ»ç–—' },
  { id: '6', code: '7113', name: 'Top Glove', price: 1.08, change: -0.05, sector: 'åŒ»ç–—' },
  { id: '7', code: '5183', name: 'PetChem', price: 5.40, change: 0.00, sector: 'å·¥ä¸š' },
  { id: '8', code: '6012', name: 'Maxis', price: 3.55, change: -0.03, sector: 'ç”µè®¯' },
  { id: '9', code: '3182', name: 'Genting', price: 4.12, change: 0.08, sector: 'æ¶ˆè´¹' },
];

const SECTORS = ['å…¨éƒ¨', 'é‡‘è', 'åŒ»ç–—', 'å…¬ç”¨äº‹ä¸š', 'å·¥ä¸š', 'ç”µè®¯', 'æ¶ˆè´¹'];

const App = () => {
  const [selected, setSelected] = useState(STOCKS[0]);
  const [query, setQuery] = useState('');
  const [activeSector, setActiveSector] = useState('å…¨éƒ¨');

  // æ¨¡æ‹Ÿå†å²æ•°æ®ç”Ÿæˆ
  const chartData = useMemo(() => {
    let curr = selected.price;
    return Array.from({ length: 24 }).map((_, i) => {
      const move = (Math.random() - 0.48) * (selected.price * 0.02);
      curr += move;
      return {
        time: `${i}:00`,
        price: parseFloat(curr.toFixed(2)),
        ma: parseFloat((curr * (0.98 + Math.random() * 0.04)).toFixed(2)),
        rsi: Math.floor(Math.random() * 50) + 25
      };
    });
  }, [selected]);

  const latest = chartData[chartData.length - 1];

  // æ™ºèƒ½åˆ†æé€»è¾‘
  const getAnalysis = () => {
    if (latest.rsi < 35) return { status: 'å»ºè®®ä¹°å…¥', color: 'text-emerald-500', bg: 'bg-emerald-50', msg: 'æåº¦è¶…å–ï¼é˜¿ç››ï¼Œè¿™æ˜¯æŠ„åº•çš„å¥½æ—¶æœºï¼ŒMoney å·²ç»å‡†å¤‡å¥½æ‰‘ä¸Šå»äº†ï¼' };
    if (latest.rsi > 65) return { status: 'å»ºè®®å–å‡º', color: 'text-rose-500', bg: 'bg-rose-50', msg: 'å·²ç»å¤ªè´µäº†ï¼Money å»ºè®®èµ¶ç´§æ’¤é€€ï¼Œä¿ä½ç›ˆåˆ©ä¹°ç½å¤´ã€‚' };
    return { status: 'å»ºè®®æŒè‚¡', color: 'text-blue-500', bg: 'bg-blue-50', msg: 'è¶‹åŠ¿è¿˜ä¸æ¸…æ™°ï¼ŒMoney å»ºè®®åƒçŒ«ä¸€æ ·é™é™è§‚å¯Ÿã€‚' };
  };

  const analysis = getAnalysis();

  // é€‰è‚¡ç­›é€‰é€»è¾‘
  const filtered = useMemo(() => {
    return STOCKS.filter(s => {
      const matchQuery = s.name.toLowerCase().includes(query.toLowerCase()) || s.code.includes(query);
      const matchSector = activeSector === 'å…¨éƒ¨' || s.sector === activeSector;
      return matchQuery && matchSector;
    });
  }, [query, activeSector]);

  return (
    <div className="flex flex-col h-screen bg-[#f8fafc] text-slate-900 font-sans overflow-hidden">
      
      {/* --- é¡¶éƒ¨é€‰è‚¡æ  (Top Selection Bar) --- */}
      <nav className="bg-white border-b border-slate-200 shadow-sm shrink-0 z-20">
        <div className="px-6 py-3 flex items-center justify-between gap-6 border-b border-slate-100">
          <div className="flex items-center gap-3">
            <div className="bg-blue-600 p-2 rounded-xl text-white shadow-lg shadow-blue-200 shrink-0">
              <TrendingUp size={20} />
            </div>
            <div>
              <h1 className="font-black text-lg tracking-tighter leading-none">Money ç»ˆç«¯</h1>
              <p className="text-[10px] text-slate-400 font-bold uppercase tracking-widest mt-0.5">Bursa Malaysia</p>
            </div>
          </div>

          {/* æœç´¢ä¸ç­›é€‰ */}
          <div className="flex items-center gap-4 flex-1 max-w-2xl">
            <div className="relative flex-1">
              <Search className="absolute left-3 top-2.5 text-slate-400" size={16} />
              <input 
                className="w-full bg-slate-100 border-none rounded-xl pl-10 pr-4 py-2 text-sm focus:ring-2 focus:ring-blue-500 outline-none transition-all"
                placeholder="æœç´¢åç§°/ä»£ç ..."
                value={query}
                onChange={(e) => setQuery(e.target.value)}
              />
            </div>
            <div className="flex items-center gap-1.5 overflow-x-auto scrollbar-hide py-1">
              {SECTORS.map(sector => (
                <button
                  key={sector}
                  onClick={() => setActiveSector(sector)}
                  className={`whitespace-nowrap px-3 py-1.5 rounded-lg text-[10px] font-black transition-all ${activeSector === sector ? 'bg-slate-900 text-white shadow-md' : 'bg-white text-slate-400 border border-slate-200 hover:border-blue-500 hover:text-blue-500'}`}
                >
                  {sector}
                </button>
              ))}
            </div>
          </div>

          <div className="text-right shrink-0 hidden sm:block">
            <p className="text-[10px] font-bold text-slate-400 uppercase tracking-widest">é¦–å¸­åˆ†æå®˜</p>
            <p className="text-sm font-bold text-slate-700">Money ğŸ± & é˜¿ç›› ğŸ‘¨â€ğŸ’»</p>
          </div>
        </div>

        {/* é€‰è‚¡æ¨ªå‘æ»šåŠ¨æ¡ */}
        <div className="px-4 py-3 flex items-center gap-3 overflow-x-auto scrollbar-hide bg-slate-50/50">
          <div className="flex items-center gap-2 px-3 border-r border-slate-200 shrink-0">
            <LayoutGrid size={14} className="text-slate-400" />
            <span className="text-[10px] font-bold text-slate-400 uppercase">å¿«é€Ÿé€‰è‚¡</span>
          </div>
          <div className="flex gap-3 pr-6">
            {filtered.length > 0 ? filtered.map(stock => (
              <button
                key={stock.id}
                onClick={() => setSelected(stock)}
                className={`flex items-center gap-3 p-2 pr-4 rounded-xl transition-all shrink-0 ${selected.id === stock.id ? 'bg-white border-blue-500 border-2 shadow-sm' : 'bg-white/50 border border-slate-200 hover:border-blue-300'}`}
              >
                <div className={`w-1 h-8 rounded-full ${stock.change >= 0 ? 'bg-emerald-500' : 'bg-rose-500'}`}></div>
                <div className="text-left">
                  <p className="text-xs font-bold leading-none mb-1">{stock.name}</p>
                  <p className="text-[9px] text-slate-400 font-mono">{stock.code}.KL</p>
                </div>
                <div className="text-right ml-2 border-l border-slate-100 pl-3">
                  <p className="text-xs font-black font-mono leading-none mb-1">RM {stock.price}</p>
                  <p className={`text-[9px] font-bold flex items-center justify-end ${stock.change >= 0 ? 'text-emerald-500' : 'text-rose-500'}`}>
                    {stock.change >= 0 ? '+' : ''}{stock.change.toFixed(2)}
                  </p>
                </div>
              </button>
            )) : (
              <div className="py-2 px-4 text-xs italic text-slate-400">æœªæ‰¾åˆ°ç¬¦åˆæ¡ä»¶çš„è‚¡ç¥¨</div>
            )}
          </div>
        </div>
      </nav>

      {/* --- ä¸»ä½“å†…å®¹åŒº --- */}
      <main className="flex-1 overflow-y-auto bg-[#f8fafc]">
        <div className="max-w-7xl mx-auto p-6 md:p-8 space-y-6">
          
          {/* ç¬¬ä¸€è¡Œï¼šçŠ¶æ€é¢æ¿ */}
          <div className="grid grid-cols-1 md:grid-cols-4 gap-6">
            <div className="bg-white p-6 rounded-[2.5rem] shadow-sm border border-slate-100 flex flex-col justify-center">
              <div className="flex items-center gap-2 text-slate-400 text-[11px] font-black uppercase mb-3 tracking-widest">
                <Zap size={16} className="text-amber-500" /> å½“å‰å¸‚ä»·
              </div>
              <div className="flex items-baseline gap-2">
                <span className="text-4xl font-black font-mono tracking-tighter">RM {selected.price}</span>
                <span className={`text-sm font-bold ${selected.change >= 0 ? 'text-emerald-500' : 'text-rose-500'}`}>
                  ({selected.change >= 0 ? '+' : ''}{((selected.change / selected.price) * 100).toFixed(2)}%)
                </span>
              </div>
            </div>

            <div className="bg-white p-6 rounded-[2.5rem] shadow-sm border border-slate-100 flex flex-col justify-center">
              <div className="flex items-center gap-2 text-slate-400 text-[11px] font-black uppercase mb-3 tracking-widest">
                <BarChart3 size={16} className="text-blue-500" /> RSI (å¼ºå¼±æŒ‡æ ‡)
              </div>
              <div className="flex items-center justify-between">
                <div className="text-4xl font-black font-mono tracking-tighter text-blue-600">{latest.rsi}</div>
                <div className="flex-1 ml-4 bg-slate-100 h-2 rounded-full overflow-hidden">
                  <div className={`h-full ${latest.rsi < 35 ? 'bg-emerald-500' : (latest.rsi > 65 ? 'bg-rose-500' : 'bg-blue-500')}`} style={{width: `${latest.rsi}%`}}></div>
                </div>
              </div>
            </div>

            <div className="bg-white p-6 rounded-[2.5rem] shadow-sm border border-slate-100 md:col-span-2 flex items-center justify-between hover:shadow-md transition-all group">
              <div className="flex flex-col">
                <div className="flex items-center gap-2 text-slate-400 text-[11px] font-black uppercase mb-3 tracking-widest">
                  <ShieldCheck size={16} className="text-emerald-500" /> Money çš„æ“ç›˜è¯„çº§
                </div>
                <div className={`text-4xl font-black tracking-tighter ${analysis.color}`}>{analysis.status}</div>
              </div>
              <div className={`px-6 py-4 rounded-3xl font-black text-sm shadow-inner flex flex-col items-center ${analysis.bg} ${analysis.color}`}>
                <span className="text-[10px] opacity-60">ä¿¡å·å¼ºåº¦</span>
                <span className="text-xl">HIGH</span>
              </div>
            </div>
          </div>

          {/* ç¬¬äºŒè¡Œï¼šå›¾è¡¨ä¸ Money æƒ…æŠ¥ä¸­å¿ƒ */}
          <div className="grid grid-cols-1 lg:grid-cols-3 gap-6">
            {/* ä¸»å›¾è¡¨ */}
            <div className="lg:col-span-2 bg-white p-8 rounded-[3rem] shadow-sm border border-slate-100 min-h-[450px] flex flex-col">
              <div className="flex items-center justify-between mb-8">
                <div>
                  <h3 className="font-black text-xl text-slate-800 flex items-center gap-2">
                    <Activity size={20} className="text-blue-600" /> ä»·æ ¼åŠ¨æ€åˆ†æ
                  </h3>
                  <p className="text-xs text-slate-400 font-bold mt-1 uppercase tracking-widest">{selected.name} â€¢ 24H TRACKING</p>
                </div>
                <div className="flex items-center gap-6">
                  <div className="flex items-center gap-2 text-[11px] font-black text-slate-400">
                    <div className="w-3 h-3 rounded-full bg-blue-500 shadow-sm shadow-blue-200"></div> PRICE
                  </div>
                  <div className="flex items-center gap-2 text-[11px] font-black text-slate-400">
                    <div className="w-3 h-3 rounded-full bg-slate-200 border border-slate-300"></div> MA (20)
                  </div>
                </div>
              </div>
              <div className="flex-1">
                <ResponsiveContainer width="100%" height="100%">
                  <AreaChart data={chartData}>
                    <defs>
                      <linearGradient id="colorPrice" x1="0" y1="0" x2="0" y2="1">
                        <stop offset="5%" stopColor="#3b82f6" stopOpacity={0.25}/>
                        <stop offset="95%" stopColor="#3b82f6" stopOpacity={0}/>
                      </linearGradient>
                    </defs>
                    <CartesianGrid strokeDasharray="3 3" vertical={false} stroke="#f1f5f9" />
                    <XAxis dataKey="time" hide />
                    <YAxis domain={['auto', 'auto']} tick={{fontSize: 10, fill: '#94a3b8', fontWeight: 'bold'}} axisLine={false} tickLine={false} />
                    <Tooltip 
                      contentStyle={{ borderRadius: '24px', border: 'none', boxShadow: '0 25px 50px -12px rgba(0,0,0,0.15)' }}
                      itemStyle={{fontSize: '14px', fontWeight: '900', padding: '4px 0'}}
                      cursor={{stroke: '#3b82f6', strokeWidth: 2}}
                    />
                    <Area type="monotone" dataKey="price" stroke="#3b82f6" strokeWidth={5} fillOpacity={1} fill="url(#colorPrice)" />
                    <Line type="monotone" dataKey="ma" stroke="#e2e8f0" strokeWidth={3} dot={false} strokeDasharray="6 6" />
                  </AreaChart>
                </ResponsiveContainer>
              </div>
            </div>

            {/* Money çš„çŒ«å’ªæƒ…æŠ¥ä¸­å¿ƒ */}
            <div className="bg-[#1e293b] text-white p-8 rounded-[3rem] shadow-2xl flex flex-col relative overflow-hidden group">
              <div className="absolute -top-10 -right-10 p-12 opacity-5 group-hover:opacity-10 transition-all duration-500">
                <MessageSquare size={200} />
              </div>
              <div className="relative z-10 flex flex-col h-full">
                <div className="flex items-center gap-4 mb-8">
                  <div className="w-16 h-16 bg-gradient-to-tr from-blue-500 to-indigo-600 rounded-[1.5rem] flex items-center justify-center text-4xl shadow-xl shadow-blue-500/20">ğŸ±</div>
                  <div>
                    <h4 className="font-black text-xl tracking-tight">Money æ“ç›˜å®¤</h4>
                    <p className="text-[11px] text-blue-400 font-black uppercase tracking-widest mt-0.5">Master Analyst Money</p>
                  </div>
                </div>
                
                <div className="flex-1 bg-white/5 backdrop-blur-sm rounded-[2rem] p-6 mb-8 border border-white/10 italic text-base leading-relaxed text-slate-300 shadow-inner flex flex-col justify-center">
                  â€œ{analysis.msg}â€
                </div>

                <div className="space-y-5 mb-8">
                  <div className="flex items-center justify-between p-4 bg-white/5 rounded-2xl border border-white/5">
                    <span className="text-slate-500 font-black text-xs uppercase tracking-widest">å…³é”®æ”¯æ’‘ä½</span>
                    <span className="font-mono font-black text-lg">RM {(selected.price * 0.97).toFixed(2)}</span>
                  </div>
                  <div className="flex items-center justify-between p-4 bg-white/5 rounded-2xl border border-white/5">
                    <span className="text-slate-500 font-black text-xs uppercase tracking-widest">å…³é”®å‹åŠ›ä½</span>
                    <span className="font-mono font-black text-lg text-blue-400">RM {(selected.price * 1.05).toFixed(2)}</span>
                  </div>
                </div>
                
                <button className="w-full bg-blue-600 hover:bg-blue-500 text-white font-black py-5 rounded-[1.5rem] transition-all flex items-center justify-center gap-3 shadow-2xl shadow-blue-900/50 active:scale-95 text-lg">
                  <Target size={22} /> æ‰§è¡Œç­–ç•¥
                </button>
              </div>
            </div>
          </div>
          
          {/* åº•éƒ¨è¯¦ç»†ä¿¡æ¯æ  */}
          <div className="bg-white p-8 rounded-[2.5rem] border border-slate-100 flex flex-col md:flex-row items-center justify-between shadow-sm gap-6">
            <div className="flex flex-wrap justify-center gap-12">
              <div className="flex flex-col">
                <span className="text-[11px] font-black text-slate-400 uppercase tracking-[0.2em] mb-2">æ‰€å±è¡Œä¸šæ¿å—</span>
                <span className="text-base font-black text-slate-700 bg-slate-50 px-4 py-2 rounded-xl border border-slate-100 shadow-inner">{selected.sector}</span>
              </div>
              <div className="flex flex-col border-l border-slate-100 pl-12">
                <span className="text-[11px] font-black text-slate-400 uppercase tracking-[0.2em] mb-2">æˆäº¤é‡çŠ¶æ€</span>
                <span className="text-base font-black text-emerald-500 flex items-center gap-2">
                  <Filter size={16} /> é…åˆæ”¾é‡ (BULLISH)
                </span>
              </div>
              <div className="flex flex-col border-l border-slate-100 pl-12">
                <span className="text-[11px] font-black text-slate-400 uppercase tracking-[0.2em] mb-2">æ³¢åŠ¨ç‡ (ATR)</span>
                <span className="text-base font-black text-slate-700">0.024 (ç¨³å®š)</span>
              </div>
            </div>
            <div className="flex items-center gap-3 bg-slate-50 px-6 py-3 rounded-2xl border border-slate-100">
              <Activity className="text-blue-500" size={16} />
              <span className="text-[11px] font-bold text-slate-400 uppercase tracking-widest">æ•°æ®æœ€ååŒæ­¥: 11:15 AM</span>
            </div>
          </div>

        </div>
      </main>

    </div>
  );
};

export default App;
