import React, { useState, useMemo } from 'react';
import { 
  AreaChart, Area, XAxis, YAxis, CartesianGrid, Tooltip, ResponsiveContainer, Line, LineChart 
} from 'recharts';
import { 
  TrendingUp, Search, Activity, ArrowUpCircle, ArrowDownCircle, Info, Wallet, PieChart, AlertCircle
} from 'lucide-react';

// æ¨¡æ‹Ÿé©¬è‚¡æ•°æ®
const STOCKS_DATA = [
  { id: '1', code: '1155', name: 'Maybank', price: 10.54, change: 0.02, sector: 'é‡‘è' },
  { id: '2', code: '1295', name: 'Public Bank', price: 4.50, change: -0.01, sector: 'é‡‘è' },
  { id: '3', code: '5347', name: 'Tenaga Nasional', price: 14.20, change: 0.15, sector: 'å…¬ç”¨äº‹ä¸š' },
  { id: '4', code: '5225', name: 'IHH Healthcare', price: 7.15, change: 0.05, sector: 'åŒ»ç–—' },
  { id: '5', code: '7113', name: 'Top Glove', price: 1.12, change: -0.03, sector: 'åŒ»ç–—' },
];

const App = () => {
  const [selectedStock, setSelectedStock] = useState(STOCKS_DATA[0]);
  const [searchTerm, setSearchTerm] = useState('');

  // æ¨¡æ‹Ÿå†å²æ•°æ®ç”Ÿæˆ
  const history = useMemo(() => {
    let startPrice = selectedStock.price;
    return Array.from({ length: 15 }).map((_, i) => {
      const vol = (Math.random() - 0.5) * 0.2;
      startPrice += vol;
      return {
        name: `T-${15 - i}`,
        price: parseFloat(startPrice.toFixed(2)),
        ma: parseFloat((startPrice * 0.98).toFixed(2)),
        rsi: Math.floor(Math.random() * 40) + 30
      };
    });
  }, [selectedStock]);

  const currentData = history[history.length - 1];

  // ä¹°å–å»ºè®®é€»è¾‘
  const getAction = () => {
    if (currentData.rsi < 35) return { label: 'å»ºè®®ä¹°å…¥', color: 'text-green-600', bg: 'bg-green-50', icon: ArrowUpCircle, tip: 'è¶…å–ä¿¡å·ï¼Money è§‰å¾—ç°åœ¨æ˜¯æ¡ä¾¿å®œçš„å¥½æœºä¼šã€‚' };
    if (currentData.rsi > 65) return { label: 'å»ºè®®å–å‡º', color: 'text-red-600', bg: 'bg-red-50', icon: ArrowDownCircle, tip: 'è¶…ä¹°ä¿¡å·ï¼Money å»ºè®®å…ˆå¥—ç°æ¢ç‚¹å°é±¼å¹²ã€‚' };
    return { label: 'è§‚æœ›/æŒæœ‰', color: 'text-blue-600', bg: 'bg-blue-50', icon: Info, tip: 'ç›®å‰èµ°åŠ¿å¹³ç¨³ï¼Œé˜¿ç››å¯ä»¥å…ˆå–æ¯èŒ¶å†è§‚å¯Ÿã€‚' };
  };

  const action = getAction();
  const filtered = STOCKS_DATA.filter(s => s.name.toLowerCase().includes(searchTerm.toLowerCase()) || s.code.includes(searchTerm));

  return (
    <div className="min-h-screen bg-slate-50 p-4 md:p-6 text-slate-800 font-sans">
      <div className="max-w-6xl mx-auto">
        {/* Header */}
        <header className="flex flex-col md:flex-row justify-between items-start md:items-center mb-6 gap-4">
          <div>
            <h1 className="text-2xl font-bold flex items-center gap-2 text-slate-900">
              <TrendingUp className="text-blue-600" /> Money æŠ•èµ„åŠ©æ‰‹ (Bursa)
            </h1>
            <p className="text-slate-500 text-sm">ä½ å¥½ é˜¿ç››ï¼Money æ­£åœ¨åŠªåŠ›ä¸ºä½ åˆ†ææ•°æ® ğŸ±ğŸ“ˆ</p>
          </div>
          <div className="relative w-full md:w-72">
            <Search className="absolute left-3 top-2.5 text-slate-400 w-4 h-4" />
            <input 
              className="w-full pl-10 pr-4 py-2 bg-white border border-slate-200 rounded-xl shadow-sm focus:ring-2 focus:ring-blue-500 outline-none"
              placeholder="æœç´¢è‚¡ç¥¨åç§°æˆ–ä»£ç ..."
              onChange={(e) => setSearchTerm(e.target.value)}
            />
          </div>
        </header>

        <div className="grid grid-cols-1 lg:grid-cols-12 gap-6">
          {/* Left Sidebar */}
          <div className="lg:col-span-4 space-y-4">
            <div className="bg-white p-4 rounded-2xl shadow-sm border border-slate-100">
              <h2 className="text-xs font-bold text-slate-400 uppercase mb-3 flex items-center gap-2">
                <Activity className="w-3 h-3" /> æˆ‘çš„è§‚å¯Ÿæ¸…å•
              </h2>
              <div className="space-y-2">
                {filtered.map(stock => (
                  <button 
                    key={stock.id}
                    onClick={() => setSelectedStock(stock)}
                    className={`w-full flex justify-between p-3 rounded-xl transition-all ${selectedStock.id === stock.id ? 'bg-blue-600 text-white shadow-lg' : 'bg-slate-50 hover:bg-slate-100 text-slate-700'}`}
                  >
                    <div className="text-left">
                      <p className="font-bold">{stock.name}</p>
                      <p className={`text-xs ${selectedStock.id === stock.id ? 'text-blue-100' : 'text-slate-400'}`}>{stock.code}.KL</p>
                    </div>
                    <div className="text-right">
                      <p className="font-mono font-bold">RM {stock.price}</p>
                      <p className={`text-xs ${stock.change >= 0 ? (selectedStock.id === stock.id ? 'text-white' : 'text-green-600') : (selectedStock.id === stock.id ? 'text-white' : 'text-red-600')}`}>
                        {stock.change > 0 ? '+' : ''}{stock.change}
                      </p>
                    </div>
                  </button>
                ))}
              </div>
            </div>

            {/* Money's Card */}
            <div className="bg-gradient-to-br from-indigo-600 to-blue-700 p-6 rounded-2xl text-white shadow-xl">
              <div className="flex items-center gap-3 mb-3">
                <div className="text-3xl">ğŸ±</div>
                <div>
                  <p className="text-indigo-100 text-xs font-bold uppercase">Money çš„å»ºè®®</p>
                  <p className="font-bold">é¦–å¸­åˆ†æå®˜</p>
                </div>
              </div>
              <p className="text-sm opacity-90 leading-relaxed italic border-t border-white/20 pt-3">
                â€œé˜¿ç››ï¼ŒæŠ•èµ„è¦åƒæˆ‘æ‰è€é¼ ä¸€æ ·ï¼Œé™å¦‚å¤„å­ï¼ŒåŠ¨å¦‚è„±å…”ã€‚ç°åœ¨çš„ RSI è¡¨ç°ç¨³å¥ï¼Œåˆ«æ…Œã€‚â€
              </p>
            </div>
          </div>

          {/* Right Main Content */}
          <div className="lg:col-span-8 space-y-6">
            {/* Quick Cards */}
            <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
              <div className="bg-white p-5 rounded-2xl shadow-sm border border-slate-100">
                <div className="flex items-center gap-2 mb-2 text-slate-500 text-xs font-bold uppercase">
                  <Wallet className="w-3 h-3" /> å½“å‰ä»· (RM)
                </div>
                <p className="text-2xl font-bold font-mono">{selectedStock.price}</p>
              </div>
              <div className="bg-white p-5 rounded-2xl shadow-sm border border-slate-100">
                <div className="flex items-center gap-2 mb-2 text-slate-500 text-xs font-bold uppercase">
                  <PieChart className="w-3 h-3" /> RSI æŒ‡æ ‡
                </div>
                <p className="text-2xl font-bold font-mono">{currentData.rsi}</p>
              </div>
              <div className={`p-5 rounded-2xl shadow-sm border border-slate-100 ${action.bg}`}>
                <div className="flex items-center gap-2 mb-2 text-slate-500 text-xs font-bold uppercase">
                  <action.icon className={`w-3 h-3 ${action.color}`} /> ç»¼åˆè¯„åˆ†
                </div>
                <p className={`text-2xl font-bold ${action.color}`}>{action.label}</p>
              </div>
            </div>

            {/* Chart */}
            <div className="bg-white p-6 rounded-2xl shadow-sm border border-slate-100">
              <h3 className="font-bold text-slate-800 mb-6 flex justify-between items-center">
                <span>{selectedStock.name} è¿‘æœŸèµ°åŠ¿</span>
                <span className="text-xs font-normal text-slate-400">å•ä½: é©¬å¸ (RM)</span>
              </h3>
              <div className="h-64 w-full">
                <ResponsiveContainer width="100%" height="100%">
                  <AreaChart data={history}>
                    <defs>
                      <linearGradient id="colorPrice" x1="0" y1="0" x2="0" y2="1">
                        <stop offset="5%" stopColor="#3b82f6" stopOpacity={0.2}/>
                        <stop offset="95%" stopColor="#3b82f6" stopOpacity={0}/>
                      </linearGradient>
                    </defs>
                    <CartesianGrid strokeDasharray="3 3" vertical={false} stroke="#f1f5f9" />
                    <XAxis dataKey="name" hide />
                    <YAxis domain={['auto', 'auto']} tick={{fontSize: 11}} axisLine={false} tickLine={false} />
                    <Tooltip contentStyle={{borderRadius: '12px', border: 'none', boxShadow: '0 4px 12px rgba(0,0,0,0.1)'}} />
                    <Area type="monotone" dataKey="price" stroke="#3b82f6" strokeWidth={3} fillOpacity={1} fill="url(#colorPrice)" />
                    <Line type="monotone" dataKey="ma" stroke="#f59e0b" strokeWidth={2} dot={false} strokeDasharray="4 4" />
                  </AreaChart>
                </ResponsiveContainer>
              </div>
            </div>

            {/* Strategy Detail */}
            <div className="bg-white p-6 rounded-2xl shadow-sm border border-slate-100">
              <h3 className="font-bold flex items-center gap-2 mb-4 text-slate-800 uppercase text-sm tracking-widest">
                <AlertCircle className="w-4 h-4 text-amber-500" /> ç­–ç•¥è¯¦æƒ…
              </h3>
              <div className="p-4 bg-slate-50 rounded-xl">
                <p className="text-slate-700 leading-relaxed font-medium">
                  â€œ{action.tip}â€
                </p>
                <div className="mt-4 flex gap-3 overflow-x-auto pb-2">
                  <span className="shrink-0 px-3 py-1 bg-white border border-slate-200 rounded-lg text-[10px] font-bold text-slate-500">æ¿å—: {selectedStock.sector}</span>
                  <span className="shrink-0 px-3 py-1 bg-white border border-slate-200 rounded-lg text-[10px] font-bold text-slate-500">æˆäº¤é‡: é…åˆ</span>
                  <span className="shrink-0 px-3 py-1 bg-white border border-slate-200 rounded-lg text-[10px] font-bold text-slate-500">æ”¯æ’‘ä½: RM {(selectedStock.price * 0.96).toFixed(2)}</span>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      <footer className="mt-8 text-center text-slate-400 text-xs">
        <p>Â© 2026 Money æŠ•èµ„åŠ©æ‰‹ - ä»…ä¾›é˜¿ç›› (Castor) å‚è€ƒ</p>
      </footer>
    </div>
  );
};

export default App;
