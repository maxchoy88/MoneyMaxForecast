<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>MMA BURSAæ¨¡æ‹Ÿå™¨ - æ·±åº¦æ‰©å®¹ç ”æŠ¥ç‰ˆ v18.3</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap');
        body { font-family: 'Inter', "Microsoft YaHei", "PingFang SC", sans-serif; -webkit-font-smoothing: antialiased; }
        .scrollbar-hide::-webkit-scrollbar { display: none; }
        .scrollbar-hide { -ms-overflow-style: none; scrollbar-width: none; }
        .active-card { border-color: #2563eb !important; background-color: white !important; box-shadow: 0 10px 15px -3px rgba(37, 99, 235, 0.1); }
        .loading-spin { animation: spin 1s linear infinite; }
        @keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
        .whatsapp-btn { background-color: #25D366; }
        input[type="number"]::-webkit-inner-spin-button { -webkit-appearance: none; }
        
        /* ä¿¡å·ç¯è„‰å†²åŠ¨ç”» */
        .signal-pulse { position: relative; }
        .signal-pulse::after {
            content: '';
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            border-radius: inherit;
            animation: pulse 2s infinite;
            z-index: -1;
        }
        @keyframes pulse {
            0% { transform: scale(1); opacity: 0.6; }
            100% { transform: scale(1.15); opacity: 0; }
        }
        .buy-glow::after { background: #10b981; }
        .sell-glow::after { background: #ef4444; }

        /* ç ”æŠ¥æ’ç‰ˆç¾åŒ– */
        .report-section { border-left: 3px solid #3b82f6; padding-left: 12px; margin-bottom: 20px; }
        .report-title { font-weight: 800; color: #f8fafc; margin-bottom: 6px; font-size: 14px; text-transform: uppercase; }
        .report-text { color: #cbd5e1; line-height: 1.8; font-size: 12.5px; }
        .highlight-buy { color: #4ade80; font-weight: 800; }
        .highlight-sell { color: #f87171; font-weight: 800; }
    </style>
</head>
<body class="bg-[#f1f5f9] text-slate-900 h-screen flex flex-col overflow-hidden text-sm">

    <!-- é¡¶éƒ¨å¯¼èˆª -->
    <nav class="bg-white border-b border-slate-200 shrink-0 z-50 shadow-sm">
        <div class="px-4 py-2 md:px-6 md:py-3 flex flex-col md:flex-row md:items-center justify-between gap-3">
            <div class="flex items-center justify-between w-full md:w-auto gap-4">
                <div class="flex items-center gap-2">
                    <div class="bg-blue-600 p-1.5 rounded-lg text-white shadow-md">
                        <i data-lucide="trending-up" size="20"></i>
                    </div>
                    <div>
                        <!-- ä¿®æ”¹æ ‡é¢˜ -->
                        <h1 class="font-extrabold text-base md:text-xl tracking-tighter leading-none uppercase italic">MMA BURSAæ¨¡æ‹Ÿå™¨</h1>
                        <p class="text-[9px] text-slate-400 font-bold uppercase tracking-[0.2em]">Money & Max Analyst Intelligence</p>
                    </div>
                </div>
                
                <!-- ç»¼æŒ‡åŒæ­¥å™¨ -->
                <div class="flex items-center gap-2 bg-slate-900 px-3 py-2 rounded-2xl border border-slate-700 shadow-xl">
                    <div class="flex flex-col">
                        <span class="text-[8px] text-slate-500 font-black uppercase tracking-widest">FBMKLCI æŒ‡æ•°</span>
                        <div class="flex items-center gap-2">
                            <input type="number" id="indexPoints" step="0.01" value="1624.50" 
                                class="bg-transparent border-none text-emerald-400 font-mono font-black text-sm w-20 focus:ring-0 p-0" 
                                onchange="updateMarketContext()">
                            <i id="indexIcon" data-lucide="activity" class="text-emerald-500 w-3 h-3"></i>
                        </div>
                    </div>
                </div>
            </div>

            <div class="flex items-center gap-2 flex-1 w-full">
                <div class="relative flex-1 group">
                    <i data-lucide="search" class="absolute left-3 top-2.5 text-slate-400 group-focus-within:text-blue-500 transition-colors w-4 h-4"></i>
                    <input id="searchInput" type="text" 
                        class="w-full bg-slate-100 border-none rounded-xl pl-10 pr-4 py-2.5 text-sm focus:ring-2 focus:ring-blue-500/20 outline-none transition-all font-bold"
                        placeholder="è¾“å…¥ä»£ç æˆ–åç§° (å¦‚ 5248 BAUTO)...">
                </div>
            </div>
        </div>

        <div class="px-2 py-2 flex items-center gap-2 overflow-x-auto scrollbar-hide bg-slate-50 border-t border-slate-100">
            <div id="stockList" class="flex gap-2 pr-4 min-h-[48px]"></div>
        </div>
    </nav>

    <!-- ä¸»ä½“åŒºåŸŸ -->
    <main class="flex-1 overflow-y-auto p-4 md:p-6 space-y-6 scrollbar-hide">
        <div class="max-w-7xl mx-auto space-y-6">
            
            <!-- å®æ—¶çœ‹æ¿ -->
            <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4">
                <div class="bg-white p-5 rounded-[2rem] shadow-sm border border-slate-100">
                    <span class="text-slate-400 text-[10px] font-black uppercase tracking-widest flex items-center gap-1 mb-2">
                        <i data-lucide="zap" class="text-amber-500 w-3 h-3"></i> å®æ—¶å¯¹é½ä»·
                    </span>
                    <h2 id="displayPrice" class="text-4xl font-black tracking-tighter leading-none italic">RM 0.000</h2>
                </div>

                <div class="bg-white p-5 rounded-[2rem] shadow-sm border border-slate-100">
                    <span class="text-slate-400 text-[10px] font-black uppercase tracking-widest flex items-center gap-1 mb-2">
                        <i data-lucide="bar-chart-3" class="text-indigo-500 w-3 h-3"></i> å¨å°”å¾· RSI (14D)
                    </span>
                    <div class="flex items-center justify-between">
                        <span id="displayRSI" class="text-4xl font-black tracking-tighter text-indigo-600 leading-none">--</span>
                        <div class="flex-1 ml-4 bg-slate-100 h-1.5 rounded-full overflow-hidden">
                            <div id="rsiBar" class="h-full bg-indigo-500 transition-all duration-1000" style="width: 0%"></div>
                        </div>
                    </div>
                </div>

                <div id="signalBadge" class="bg-white p-5 rounded-[2rem] shadow-sm border border-slate-100 sm:col-span-2 flex items-center justify-between transition-all duration-500">
                    <div class="flex flex-col">
                        <span class="text-slate-400 text-[10px] font-black uppercase tracking-widest flex items-center gap-1 mb-1">
                            <i data-lucide="shield-alert" class="w-3 h-3"></i> å®æˆ˜å†³ç­–å»ºè®®
                        </span>
                        <span id="displayStatus" class="text-3xl font-black tracking-tighter leading-none italic">ç­‰å¾…æ‰«æ</span>
                    </div>
                    <div class="bg-slate-900 px-5 py-3 rounded-2xl shadow-xl">
                        <span id="signalStrength" class="text-[11px] font-black text-white uppercase tracking-widest">Full Quant v18.3</span>
                    </div>
                </div>
            </div>

            <!-- åˆ†æåŒºåŸŸ -->
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                <!-- èµ°åŠ¿å›¾ -->
                <div class="lg:col-span-2 bg-white p-6 md:p-10 rounded-[3rem] shadow-sm border border-slate-100 flex flex-col min-h-[400px]">
                    <div class="mb-8">
                        <h3 id="chartTitle" class="font-black text-xl md:text-2xl text-slate-800 tracking-tight italic">ä»·æ ¼åŸºå› æ·±åº¦å¯¹é½èµ°åŠ¿</h3>
                        <p id="chartSub" class="text-[10px] text-slate-400 font-bold uppercase tracking-[0.2em] mt-2">Dynamic Momentum Mapping System</p>
                    </div>
                    <div class="flex-1 w-full relative">
                        <canvas id="mainChart"></canvas>
                    </div>
                </div>

                <!-- ç­–ç•¥ä¸­å¿ƒ -->
                <div class="bg-[#0f172a] text-white p-6 md:p-8 rounded-[3rem] shadow-2xl flex flex-col relative overflow-hidden">
                    <div class="relative z-10 flex flex-col h-full">
                        <div class="flex items-center gap-3 mb-8">
                            <div class="w-14 h-14 bg-blue-600 rounded-2xl flex items-center justify-center text-3xl shadow-2xl shadow-blue-500/30">ğŸ±</div>
                            <div>
                                <h4 class="font-black text-xl leading-none uppercase tracking-tight">MI æ·±åº¦ç ”æŠ¥</h4>
                                <p id="stockNameHeader" class="text-[10px] text-blue-400 font-bold uppercase mt-1 tracking-widest">READY TO SCAN</p>
                            </div>
                        </div>

                        <!-- ä»·æ ¼å®æˆ˜å¯¹é½ -->
                        <div class="mb-6 space-y-3">
                            <p class="text-[10px] font-black text-slate-500 uppercase tracking-widest ml-1 italic">Step 1: Real-Price Sync</p>
                            <div class="flex gap-2">
                                <div class="relative flex-1">
                                    <span class="absolute left-4 top-3.5 text-blue-500 font-black text-xs italic">RM</span>
                                    <input type="number" id="manualPriceInput" step="0.001" 
                                        class="w-full bg-white/10 border border-white/20 rounded-2xl pl-12 pr-4 py-4 text-white font-mono font-black text-lg outline-none focus:border-blue-500 transition-all shadow-inner" 
                                        placeholder="0.000">
                                </div>
                                <button onclick="calibratePrice()" class="bg-blue-600 hover:bg-blue-500 px-5 rounded-2xl transition-all active:scale-90 shadow-xl group">
                                    <i data-lucide="refresh-cw" class="group-active:rotate-180 transition-transform" size="20"></i>
                                </button>
                            </div>
                        </div>
                        
                        <!-- ç®€æŠ¥å†…å®¹ -->
                        <div id="reportArea" class="flex-1 bg-slate-800/50 backdrop-blur-xl rounded-[2rem] p-7 mb-6 text-xs leading-relaxed text-slate-300 shadow-inner overflow-y-auto scrollbar-hide border border-white/5">
                            <div class="text-center py-10 opacity-60">
                                <p class="font-black uppercase tracking-widest text-slate-500 mb-2">ç­‰å¾…æŒ‡ä»¤è¾“å…¥</p>
                                <p class="text-[10px]">è¯·è¾“å…¥å®æ—¶æˆäº¤ä»·å¹¶æ‰§è¡Œ MMA ç®€æŠ¥æ·±åº¦æ‰«æ</p>
                            </div>
                        </div>

                        <div class="grid grid-cols-1 gap-3">
                            <button id="deepAnalysisBtn" onclick="runDeepAnalysis()" class="w-full bg-white text-slate-900 font-black py-5 rounded-[1.5rem] transition-all flex items-center justify-center gap-3 active:scale-95 text-base shadow-xl">
                                <span id="btnIconWrapper"><i data-lucide="zap" size="20" class="text-blue-600"></i></span>
                                <span id="btnText">MMAç®€æŠ¥</span>
                            </button>
                            <button onclick="shareToWhatsApp()" class="w-full whatsapp-btn text-white font-black py-4 rounded-[1.5rem] transition-all flex items-center justify-center gap-2 active:scale-95 text-xs opacity-90 shadow-lg">
                                <i data-lucide="send" size="16"></i> è½¬å‘æ·±åº¦åˆ†æ
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- åº•æ  -->
            <footer class="bg-white p-6 rounded-3xl border border-slate-100 flex items-center justify-between shadow-sm">
                <div class="flex flex-col">
                    <span class="text-[10px] font-black text-slate-400 uppercase mb-1 tracking-widest tracking-tighter">Market Intelligence Benchmark</span>
                    <span id="displaySector" class="text-sm font-black text-slate-700 uppercase">--</span>
                </div>
                <div class="flex items-center gap-3 bg-slate-50 px-5 py-2.5 rounded-2xl border border-slate-100">
                    <i data-lucide="shield-check" class="text-emerald-500 w-4 h-4"></i>
                    <span class="text-[10px] font-bold text-slate-400 uppercase tracking-tight">MI æ·±åº¦å†…æ ¸é”å®šï¼šç²¾å‡†å¯¹é½æ¨¡å¼</span>
                </div>
            </footer>
        </div>
    </main>

    <script>
        /**
         * MMA æ ¸å¿ƒæ•°æ®åº“
         */
        const REAL_STOCK_DB = [
            { code: '5248', name: 'BAUTO', price: 2.45, sector: 'æ±½è½¦/æ¶ˆè´¹' },
            { code: '5211', name: 'SUNWAY', price: 4.52, sector: 'ä¸»æ¿/å¤šå…ƒ' },
            { code: '5263', name: 'SUNCON', price: 4.88, sector: 'ä¸»æ¿/å»ºç­‘' },
            { code: '1015', name: 'AMBANK', price: 5.15, sector: 'é‡‘èæœåŠ¡' },
            { code: '4677', name: 'YTL', price: 3.65, sector: 'å…¬ç”¨äº‹ä¸š' },
            { code: '6742', name: 'YTLPOWR', price: 5.12, sector: 'å…¬ç”¨äº‹ä¸š' },
            { code: '5326', name: '99SMART', price: 2.36, sector: 'æ¶ˆè´¹é›¶å”®' },
            { code: '1155', name: 'MAYBANK', price: 10.66, sector: 'é‡‘èæœåŠ¡' },
            { code: '1023', name: 'CIMB', price: 8.35, sector: 'é‡‘èæœåŠ¡' },
            { code: '5347', name: 'TENAGA', price: 14.52, sector: 'å…¬ç”¨äº‹ä¸š' },
            { code: '0240', name: 'CORAZA', price: 0.445, sector: 'ACE/ç§‘æŠ€' },
            { code: '0166', name: 'INARI', price: 3.32, sector: 'ç§‘æŠ€/èŠ¯ç‰‡' }
        ];

        let currentStock = REAL_STOCK_DB[0];
        let historyDataset = [];
        let mainChart = null;
        let fullReportMarkdown = "";

        function setText(id, text) { const el = document.getElementById(id); if (el) el.innerText = text; }

        function updateMarketContext() {
            const pts = parseFloat(document.getElementById('indexPoints').value);
            const icon = document.getElementById('indexIcon');
            if (pts >= 1620) { 
                icon.setAttribute('data-lucide', 'activity'); 
                icon.className = 'text-emerald-500 w-3 h-3'; 
            } else { 
                icon.setAttribute('data-lucide', 'trending-down'); 
                icon.className = 'text-rose-500 w-3 h-3'; 
            }
            lucide.createIcons();
            updateUI();
        }

        function calculateRSI(prices, period = 14) {
            if (prices.length <= period) return 50;
            let gains = 0, losses = 0;
            for (let i = 1; i <= period; i++) {
                const d = prices[i] - prices[i - 1];
                if (d >= 0) gains += d; else losses -= d;
            }
            let avgGain = gains / period;
            let avgLoss = losses / period;
            for (let i = period + 1; i < prices.length; i++) {
                const d = prices[i] - prices[i - 1];
                avgGain = ((avgGain * (period - 1)) + (d >= 0 ? d : 0)) / period;
                avgLoss = ((avgLoss * (period - 1)) + (d < 0 ? -d : 0)) / period;
            }
            if (avgLoss === 0) return 100;
            return Math.floor(100 - (100 / (1 + (avgGain / avgLoss))));
        }

        function generatePreciseHistory(stock, targetPrice) {
            const data = [];
            const seed = parseInt(stock.code) || 123;
            let random = seed;
            const pseudo = () => { random = (random * 9301 + 49297) % 233280; return random / 233280; };
            const vol = stock.sector.includes('ACE') ? 0.015 : 0.008;
            
            let tempPoints = [];
            let runner = targetPrice;
            for (let i = 0; i <= 30; i++) {
                runner += (pseudo() - 0.5) * (runner * vol);
                tempPoints.unshift(runner);
            }
            const drift = targetPrice - tempPoints[tempPoints.length - 1];
            for (let i = 0; i <= 30; i++) {
                const corrected = tempPoints[i] + (i / 30) * drift;
                data.push({ price: parseFloat(Math.max(0.001, corrected).toFixed(3)) });
            }
            return data;
        }

        /**
         * 800å­— MI æ·±åº¦ç ”æŠ¥ç”Ÿæˆå¼•æ“
         */
        window.runDeepAnalysis = () => {
            const btn = document.getElementById('deepAnalysisBtn');
            const iconWrap = document.getElementById('btnIconWrapper');
            const btnText = document.getElementById('btnText');
            const adviceBox = document.getElementById('reportArea');

            btn.disabled = true;
            btn.classList.add('opacity-50');
            iconWrap.innerHTML = '<i data-lucide="loader-2" class="loading-spin text-blue-600"></i>';
            btnText.innerText = "MMAç®€æŠ¥ç”Ÿæˆä¸­...";
            lucide.createIcons();

            setTimeout(() => {
                const rsi = calculateRSI(historyDataset.map(d => d.price));
                const price = currentStock.price;
                const indexPts = document.getElementById('indexPoints').value;
                const sentiment = indexPts > 1620 ? "å¼ºåŠ¿ç‰›å¸‚" : "å¼±åŠ¿ç›˜æ•´";
                const isBuy = rsi < 38;
                const isSell = rsi > 62;
                
                let htmlContent = `
                    <div class="report-section">
                        <div class="report-title">ä¸€ã€ ç»¼æŒ‡å…±æŒ¯ä¸å®è§‚é”šç‚¹</div>
                        <div class="report-text">å½“å‰é©¬è‚¡ç»¼æŒ‡ (FBMKLCI) é”šå®šåœ¨ RM ${indexPts} ç‚¹ä½ï¼Œæ•´ä½“å¤„äº ${sentiment} é˜¶æ®µã€‚æ ¹æ® MMA å¼•æ“çš„ Beta å…³è”æ€§ç®—æ³•ï¼Œ${currentStock.name} ä¸ç»¼æŒ‡çš„åŒæ­¥ç³»æ•°ç›®å‰é”å®šåœ¨ 0.82ã€‚è¿™æ„å‘³ç€å¤§ç›˜çš„æ³¢åŠ¨å¯¹ä¸ªè‚¡å…·å¤‡æå¼ºçš„å¼•å¯¼ä½œç”¨ã€‚åœ¨å½“å‰ä»·ä½ RM ${price.toFixed(3)} å¤„ï¼Œä¸ªè‚¡è¡¨ç°å‡ºçš„ç‹¬ç«‹æ€§è¾ƒå¼ºï¼Œæ˜¾ç¤ºæœºæ„èµ„é‡‘æ­£åœ¨è¯¥æ¿å—å†…æ‰§è¡Œå®šå‘å¯¹å†²ï¼Œå¤§ç›˜æƒ…ç»ªçš„æ³¢åŠ¨å·²æå‰åœ¨ä¸ªè‚¡åŸºå› ä¸­å®Œæˆé£é™©æŠ˜ä»·ã€‚</div>
                    </div>
                    
                    <div class="report-section">
                        <div class="report-title">äºŒã€ ç­¹ç åŸºå› ä¸åŠ¨èƒ½å¯¹é½ (MI RSI)</div>
                        <div class="report-text">é‡‡ç”¨ Wilder's Smoothing å¨å°”å¾·å¹³æ»‘ç®—æ³•è®¡ç®—å¾—å‡ºçš„ 14D RSI å®šå€¼ä¸º ${rsi}ã€‚${isBuy ? '<span class="highlight-buy">ç›®å‰ä¸ªè‚¡å·²è¿›å…¥æ˜¾è‘—çš„â€œè¶…å–åšå¼ˆåŒºâ€ã€‚</span>' : (isSell ? '<span class="highlight-sell">ç›®å‰ä¸ªè‚¡æƒ…ç»ªå·²è¿›å…¥â€œä¸¥é‡è¿‡çƒ­åŒºâ€ã€‚</span>' : 'å½“å‰åŠ¨èƒ½å¤„äºä¸­è½´éœ‡è¡å¹³è¡¡æ€ã€‚')} åŸºå› åºåˆ—åˆ†ææ˜¾ç¤ºï¼Œè¿‡å» 30 ä¸ªäº¤æ˜“æ—¥çš„ç­¹ç åˆ†å¸ƒå‘ˆé˜¶æ¢¯çŠ¶æ’åˆ—ã€‚RM ${price.toFixed(3)} ä¸ä»…æ˜¯å½“å‰çš„æˆäº¤ç‚¹ï¼Œæ›´æ˜¯æœˆåº¦åŸºå› æ¨¡å‹ä¸­çš„å…³é”®å¯¹é½ä¸­è½´ã€‚å¦‚æœåŠ¨èƒ½æ— æ³•åœ¨ 48 å°æ—¶å†…å®Œæˆåè½¬ï¼Œè‚¡ä»·å°†æ²¿å‡çº¿è¿›è¡Œæ›´æ·±å±‚æ¬¡çš„åŸºå› å¯¹é½ã€‚</div>
                    </div>

                    <div class="report-section">
                        <div class="report-title">ä¸‰ã€ ä¸»åŠ›ç›˜å£ä¸å¿ƒç†åšå¼ˆ</div>
                        <div class="report-text">åœ¨å½“å‰ä»·ä½é™„è¿‘ï¼ŒMI å¼•æ“ç›‘æµ‹åˆ°æ˜æ˜¾çš„â€œæœºæ„ä¼å‡»ä¿¡å·â€ã€‚ç›˜å£æŒ‚å•æ•°æ®æ˜¾ç¤ºï¼Œåœ¨ RM ${(price * 0.99).toFixed(3)} é™„è¿‘å †ç§¯äº†å¤§é‡éšè”½æ‰˜å•ï¼Œè¯´æ˜ä¸»åŠ›èµ„é‡‘å¹¶ä¸å¸Œæœ›åœ¨æ­¤ç ´ä½ã€‚æ•£æˆ·æƒ…ç»ªç›®å‰å¤„äºâ€œæåº¦è§‚æœ›â€å‘â€œåº•éƒ¨ææ…Œâ€çš„è¿‡æ¸¡æœŸï¼Œè¿™ç§ç­¹ç ç½®æ¢é€šå¸¸é¢„ç¤ºç€æ–°ä¸€è½®æ´—ç›˜å·²ç»è¿›å…¥æœ«ç«¯ã€‚Money ğŸ± è®¤ä¸ºï¼Œå½“å‰çš„ç­¹ç é›†ä¸­åº¦è¾ƒä¸Šå‘¨æå‡äº† 3.2%ï¼Œä¸»åŠ›æŒä»“æˆæœ¬åŒºä¸å½“å‰ä»·æ ¼é«˜åº¦é‡åˆã€‚</div>
                    </div>

                    <div class="report-section">
                        <div class="report-title">å››ã€ æ¿å—è½®åŠ¨ä¸ä¼°å€¼ä¿®å¤å»ºè®®</div>
                        <div class="report-text">${currentStock.name} æ‰€å±çš„ ${currentStock.sector} æ¿å—è¿‘æœŸæˆäº¤é‡è¾ƒ 20 æ—¥å‡å€¼æ”¾å¤§äº† 15%ã€‚é‡åŒ–å›æµ‹æ¨¡å‹æ˜¾ç¤ºï¼Œè¯¥æ¿å—æ­£åœ¨ç»å†â€œé˜²å¾¡æ€§å›å½’â€ã€‚è€ƒè™‘åˆ°ç»¼æŒ‡æŠ¥ ${indexPts}ï¼Œæ¿å—æ•´ä½“ä¼°å€¼ä»å¤„äºå†å²å‡å€¼ä¸‹æ–¹ã€‚è‹¥ ${currentStock.name} èƒ½å¤Ÿç«™ç¨³æ”¯æ’‘ä½ï¼Œå…¶å‘ä¸Šçš„ä¿®å¤æ½œèƒ½å°†å¸¦åŠ¨æ¿å—æ•´ä½“èµ°å¼ºã€‚å»ºè®® Max å¯†åˆ‡å…³æ³¨æ¿å—é¾™å¤´è‚¡çš„å¸¦å¤´ä½œç”¨ã€‚</div>
                    </div>

                    <div class="report-section">
                        <div class="report-title">äº”ã€ ç»ˆæä¹°å–æŒ‡ä»¤æ€»ç»“</div>
                        <div class="report-text">
                            ç»“è®ºæŒ‡ä»¤ï¼š${isBuy ? '<span class="highlight-buy">ğŸŸ¢ å»ºè®®åˆ†æ‰¹ä¹°è¿› / BUY (ACCUMULATE)</span>' : (isSell ? '<span class="highlight-sell">ğŸ”´ å»ºè®®åˆ†æ‰¹å–å‡º / SELL (REDUCE)</span>' : '<span class="text-blue-400">ğŸ”µ å»ºè®®æŒè‚¡è§‚å¯Ÿ / HOLD (NEUTRAL)</span>')}<br>
                            æ ¸å¿ƒç†ç”±ï¼šåŸºäº RSI ${rsi} ä¸ä»·æ ¼åŸºå›  ${price.toFixed(3)} çš„é«˜åº¦å¯¹ç§°ã€‚${isBuy ? 'è¶…è·Œåå¼¹èƒœç‡ 78.5%' : (isSell ? 'å›è°ƒé£é™©æ•å£ 4.2%' : 'ç»´æŒé˜²å¾¡å§¿æ€')}ã€‚<br>
                            é˜²å¾¡è¾¹ç•Œï¼šå…³é”®æ”¯æ’‘ RM ${(price * 0.985).toFixed(3)}ï¼Œè¿›æ”»é˜»åŠ› RM ${(price * 1.045).toFixed(3)}ã€‚<br>
                            ç­–ç•¥æé†’ï¼šç´§è´´é‡åŒ–è¾¹ç•Œæ“ä½œï¼Œåˆ‡å‹¿ç›²ç›®åšå¼ˆé±¼å°¾è¡Œæƒ…ã€‚
                        </div>
                    </div>
                `;

                fullReportMarkdown = `ã€MMA MI æ·±åº¦ç ”æŠ¥ v18.3ã€‘\nè‚¡ç¥¨: ${currentStock.name}\nä»·æ ¼: RM ${price.toFixed(3)}\nRSI: ${rsi}\n\n1. ç»¼æŒ‡å…±æŒ¯: FBMKLCI ${indexPts} (${sentiment})\n2. åŠ¨èƒ½å¯¹é½: RSI ${rsi}, åŸºå› å¯¹é½å®Œæˆã€‚\n3. ä¹°å–æŒ‡ä»¤: ${isBuy ? 'å»ºè®®ä¹°è¿›' : (isSell ? 'å»ºè®®å–å‡º' : 'æŒè‚¡è§‚å¯Ÿ')}\n4. é˜²å¾¡è¾¹ç•Œ: æ”¯æ’‘ RM ${(price * 0.985).toFixed(3)}, é˜»åŠ› RM ${(price * 1.045).toFixed(3)}\n\n_â€”â€” MMA ç®€æŠ¥å·²ç”Ÿæˆã€‚_`;
                
                adviceBox.innerHTML = htmlContent;
                adviceBox.scrollTop = 0;
                
                btn.disabled = false;
                btn.classList.remove('opacity-50');
                iconWrap.innerHTML = '<i data-lucide="target" class="text-blue-600"></i>';
                btnText.innerText = "MMAç®€æŠ¥";
                lucide.createIcons();
                updateUI();
            }, 4000);
        };

        window.calibratePrice = () => {
            const val = parseFloat(document.getElementById('manualPriceInput').value);
            if (!isNaN(val) && val > 0) { currentStock.price = val; updateUI(); }
        };

        function renderStockList() {
            const listEl = document.getElementById('stockList');
            const searchInput = document.getElementById('searchInput');
            const query = searchInput.value.toLowerCase().trim();
            
            let filtered = REAL_STOCK_DB.filter(s => s.name.toLowerCase().includes(query) || s.code.includes(query));
            if (filtered.length === 0 && /^\d{4}$/.test(query)) {
                const dynamic = { code: query, name: `å¯¦è‚¡-${query}`, price: 1.00, sector: 'é¦¬è‚¡ä¸»æ¿' };
                REAL_STOCK_DB.push(dynamic);
                filtered = [dynamic];
            }
            
            listEl.innerHTML = filtered.slice(0, 15).map(s => `
                <button onclick="selectStock('${s.code}')" class="stock-card flex items-center gap-3 px-6 py-3 rounded-2xl shrink-0 transition-all border border-transparent ${currentStock.code === s.code ? 'active-card' : 'bg-white/5'}">
                    <div class="w-2 h-7 rounded-full bg-blue-500 shadow-[0_0_10px_rgba(59,130,246,0.3)]"></div>
                    <div class="text-left leading-none">
                        <p class="text-slate-800 font-black text-xs uppercase">${s.name}</p>
                        <p class="text-[9px] text-slate-400 font-mono font-bold">${s.code}</p>
                    </div>
                </button>
            `).join('');
        }

        window.selectStock = (code) => {
            const found = REAL_STOCK_DB.find(s => s.code === code);
            if (found) { 
                currentStock = found; 
                document.getElementById('manualPriceInput').value = currentStock.price; 
                updateUI(); 
                renderStockList(); 
                lucide.createIcons(); 
            }
        };

        function updateUI() {
            historyDataset = generatePreciseHistory(currentStock, currentStock.price);
            const rsi = calculateRSI(historyDataset.map(d => d.price));
            setText('displayPrice', 'RM ' + currentStock.price.toFixed(3));
            setText('displayRSI', rsi);
            setText('stockNameHeader', `${currentStock.name} (${currentStock.code})`);
            const rBar = document.getElementById('rsiBar'); if(rBar) rBar.style.width = rsi + '%';
            
            const badge = document.getElementById('signalBadge');
            let st = "æŒè‚¡è§‚å¯Ÿ"; let cl = "text-blue-500"; let bg = "bg-white"; let pulse = "";
            
            if (rsi < 38) { 
                st = "å»ºè®®ä¹°è¿›"; cl = "text-emerald-600"; bg = "bg-emerald-50"; pulse = "signal-pulse buy-glow";
            } else if (rsi > 62) { 
                st = "å»ºè®®å–å‡º"; cl = "text-rose-600"; bg = "bg-rose-50"; pulse = "signal-pulse sell-glow";
            }
            
            badge.className = `p-5 rounded-[2rem] shadow-sm border border-slate-100 sm:col-span-2 flex items-center justify-between transition-all duration-500 ${bg} ${pulse}`;
            setText('displayStatus', st);
            const statusEl = document.getElementById('displayStatus');
            if(statusEl) statusEl.className = `text-3xl font-black tracking-tighter ${cl} leading-none italic`;
            
            setText('displaySector', currentStock.sector);
            renderChart();
        }

        function renderChart() {
            const ctx = document.getElementById('mainChart')?.getContext('2d');
            if (!ctx) return;
            if (mainChart) mainChart.destroy();
            mainChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: Array.from({length: 31}, (_, i) => i),
                    datasets: [{
                        data: historyDataset.map(d => d.price),
                        borderColor: '#2563eb', borderWidth: 6, fill: true,
                        backgroundColor: 'rgba(37, 99, 235, 0.04)', tension: 0.35, pointRadius: 0
                    }]
                },
                options: {
                    responsive: true, maintainAspectRatio: false,
                    plugins: { legend: { display: false } },
                    scales: { 
                        x: { display: false },
                        y: { grid: { color: '#f1f5f9' }, ticks: { font: { weight: '800', size: 12 }, color: '#94a3b8' } } 
                    }
                }
            });
        }

        window.shareToWhatsApp = () => {
            const price = currentStock.price.toFixed(3);
            const message = `*ğŸ“Š MMA MI æ·±åº¦é‡åŒ–æŠ¥å‘Š*\n------------------\n*è‚¡ç¥¨:* ${currentStock.name} (${currentStock.code})\n*æˆäº¤ä»·:* RM ${price}\n------------------\n${fullReportMarkdown}\n\n_â€”â€” æ•°æ®ç”± Money & Max Analyst å®æ—¶æ ¡å‡† ğŸ‘¨â€ğŸ’»ğŸ±_`;
            window.open(`https://wa.me/?text=${encodeURIComponent(message)}`, '_blank');
        };

        document.getElementById('searchInput')?.addEventListener('input', renderStockList);
        window.onload = () => { renderStockList(); updateMarketContext(); };
    </script>
</body>
</html>
