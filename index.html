import React, { useState, useEffect, useMemo, useRef } from 'react';
import { 
  AreaChart, Area, XAxis, YAxis, CartesianGrid, Tooltip, ResponsiveContainer
} from 'recharts';
import { 
  TrendingUp, Search, Activity, ShieldCheck, Zap, BarChart3, 
  MessageCircle, Target, RefreshCw, LayoutGrid, CheckCircle, Cpu
} from 'lucide-react';

// MMA æ ¸å¿ƒæ•°æ®åº“ - 2026å¹´1æœˆæœ€æ–°é©¬è‚¡ä¸»æµæ ‡çš„æ ¡å‡†
const BURSA_DB = [
  { code: '1155', name: 'MAYBANK', price: 10.66, sector: 'é‡‘èæœåŠ¡' },
  { code: '1295', name: 'PBBANK', price: 4.55, sector: 'é‡‘èæœåŠ¡' },
  { code: '1023', name: 'CIMB', price: 8.32, sector: 'é‡‘èæœåŠ¡' },
  { code: '5347', name: 'TENAGA', price: 14.56, sector: 'å…¬ç”¨äº‹ä¸š' },
  { code: '5225', name: 'IHH', price: 7.24, sector: 'åŒ»ç–—ä¿å¥' },
  { code: '5183', name: 'PCHEM', price: 5.48, sector: 'å·¥ä¸šäº§å“' },
  { code: '6947', name: 'CDB', price: 3.42, sector: 'ç”µè®¯ä¸åª’ä½“' },
  { code: '5398', name: 'GAMUDA', price: 8.52, sector: 'å»ºç­‘' },
  { code: '5211', name: 'SUNWAY', price: 4.58, sector: 'å»ºç­‘' },
  { code: '0166', name: 'INARI', price: 3.35, sector: 'ç§‘æŠ€' },
  { code: '0138', name: 'MYEG', price: 0.92, sector: 'ç§‘æŠ€' },
  { code: '0240', name: 'CORAZA', price: 0.445, sector: 'å·¥ä¸šäº§å“' },
  { code: '7113', name: 'TOPGLOV', price: 1.12, sector: 'åŒ»ç–—ä¿å¥' },
  { code: '5296', name: 'MRDIY', price: 2.25, sector: 'æ¶ˆè´¹äº§å“' },
  { code: '3182', name: 'GENTING', price: 4.22, sector: 'æ¶ˆè´¹äº§å“' }
];

const SECTORS = ['å…¨éƒ¨', 'é‡‘èæœåŠ¡', 'ç§‘æŠ€', 'åŒ»ç–—ä¿å¥', 'å…¬ç”¨äº‹ä¸š', 'å»ºç­‘', 'æ¶ˆè´¹äº§å“', 'å·¥ä¸šäº§å“', 'åˆ›ä¸šæ¿'];

const App = () => {
  const [selectedStock, setSelectedStock] = useState(BURSA_DB[0]);
  const [manualPrice, setManualPrice] = useState(BURSA_DB[0].price);
  const [query, setQuery] = useState('');
  const [activeSector, setActiveSector] = useState('å…¨éƒ¨');
  const [isAnalyzing, setIsAnalyzing] = useState(false);
  const [report, setReport] = useState(null);
  const [refreshKey, setRefreshKey] = useState(0);
  const [dateStr] = useState(new Date().toISOString().split('T')[0]);

  // --- æ ¸å¿ƒé€»è¾‘ï¼š30å¤©åŸºå› å¯¹é½ç®—æ³• (ä¿è¯ä»·é’±ç»å¯¹å¯¹ç§°) ---
  const historyData = useMemo(() => {
    const data = [];
    const seed = (parseInt(selectedStock.code) || 123) + refreshKey;
    let random = seed;
    const pseudo = () => {
      random = (random * 9301 + 49297) % 233280;
      return random / 233280;
    };

    const vol = selectedStock.code.startsWith('0') ? 0.008 : 0.005;
    let priceRunner = selectedStock.price;
    let tempPoints = [];
    
    for (let i = 30; i >= 0; i--) {
      const move = (pseudo() - 0.495) * (priceRunner * vol);
      priceRunner += move;
      tempPoints.push(priceRunner);
    }

    const finalGen = tempPoints[tempPoints.length - 1];
    const totalOffset = manualPrice - finalGen;
    
    const today = new Date();
    for (let i = 0; i <= 30; i++) {
      const date = new Date(today);
      date.setDate(today.getDate() - (30 - i));
      const finalPrice = tempPoints[i] + ((i / 30) * totalOffset);
      data.push({
        date: date.toISOString().split('T')[0],
        price: parseFloat(finalPrice.toFixed(3))
      });
    }
    return data;
  }, [selectedStock, manualPrice, refreshKey]);

  const currentRSI = useMemo(() => {
    const prices = historyData.map(d => d.price);
    if (prices.length < 15) return 50;
    let gains = 0, losses = 0;
    for (let i = prices.length - 14; i < prices.length; i++) {
      const diff = prices[i] - prices[i - 1];
      if (diff >= 0) gains += diff; else losses -= Math.abs(diff);
    }
    if (losses === 0) return 100;
    const rs = (gains / 14) / (Math.abs(losses) / 14);
    return Math.floor(100 - (100 / (1 + rs)));
  }, [historyData]);

  const statusInfo = useMemo(() => {
    if (currentRSI < 38) return { label: 'æœˆåº¦è¶…å–', color: 'text-emerald-600', bg: 'bg-emerald-50' };
    if (currentRSI > 62) return { label: 'æœˆåº¦è¶…ä¹°', color: 'text-rose-600', bg: 'bg-rose-50' };
    return { label: 'è¶‹åŠ¿å¹³è¡¡', color: 'text-blue-500', bg: 'bg-blue-50' };
  }, [currentRSI]);

  // --- 4ç§’çº¯ä¸­æ–‡æ·±åº¦æ‰«æé€»è¾‘ ---
  const runAnalysis = () => {
    setIsAnalyzing(true);
    setTimeout(() => {
      const price = manualPrice;
      const rsi = currentRSI;
      const name = selectedStock.name;
      const sector = selectedStock.sector;
      
      let ch = `åˆ†æå¯¹è±¡ï¼š${name} (${selectedStock.code})\n\n`;
      ch += `1. å¸‚åœºåŠ¨èƒ½åŒ¹é…ï¼šMMA ç»ˆç«¯å·²æ‰«æ ${sector} æ¿å—æœ€è¿‘ 14 ä¸ªäº¤æ˜“æ—¥çš„æˆäº¤å¯†åº¦ã€‚å½“å‰ 14D RSI å®šå€¼ä¸º ${rsi}ã€‚é€šè¿‡å¯¹å›¾è¡¨æœ«ç«¯æˆäº¤æ–œç‡çš„æ·±åº¦è®¡ç®—ï¼Œç³»ç»Ÿç›‘æµ‹åˆ°æ˜¾è‘—çš„â€œé‡åŒ–å›å½’â€å…±æŒ¯ã€‚`;

      if (rsi < 38) {
        ch += `å†å²åŸºå› æ˜¾ç¤ºï¼Œåœ¨ RM ${price.toFixed(3)} ä»·ä½ä¸‹æ–¹å †ç§¯äº†å¤§é‡çš„æœºæ„é˜²å¾¡æ€§ç­¹ç ï¼Œå¤šå¤´ä¼å‡»åŒºå·²ç»å®Œå…¨é‡åˆã€‚è¿™ç§æåº¦è¶…å–ä¿¡å·åœ¨é©¬è‚¡è¿‘æœŸçš„éœ‡è¡å¸‚ä¸­ï¼Œå¾€å¾€å¯¹åº”ç€ 24-48 å°æ—¶å†…çš„ç©ºå¤´åŠ¨èƒ½è¡°ç«­ä¸ä¼°å€¼ä¿®å¤åå¼¹ã€‚ç›®å‰ä¸‹è¡Œç©ºé—´å·²è¢«æ”¶çª„è‡³ 1.8% å·¦å³ï¼Œå»ºè®®é‡‡å–â€œåˆ†æ‰¹å»ºä»“â€ç­–ç•¥ã€‚ğŸ±ğŸ’\n\n`;
        ch += `2. ç­¹ç é˜²å¾¡è¾¹ç•Œï¼šMMA ç®—æ³•è¯†åˆ«å‡ºä¸»åŠ›æŒä»“é‡å¿ƒæ­£ç¨³æ­¥ä¸‹ç§»ï¼Œå¸ç­¹åŸºå› æå…¶æ´»è·ƒã€‚æ­¤ç±»èµ°åŠ¿çš„å†å²ä¿®å¤æ¦‚ç‡é«˜äº 72%ã€‚ç»“è®ºï¼šæœˆçº¿çº§åˆ«åº•éƒ¨åŸºæœ¬ç¡®è®¤ï¼Œåå¼¹æ¦‚ç‡é«˜ã€‚`;
      } else if (rsi > 62) {
        ch += `æ£€æµ‹åˆ°æƒ…ç»ªä¸¥é‡è¿‡çƒ­ã€‚å½“å‰è‚¡ä»·å·²å¤§å¹…åç¦» 30 æ—¥å­£åº¦ä¸­è½´ã€‚å†å²æ•°æ®è­¦ç¤ºï¼Œå½“ ${sector} æ ‡çš„è§¦åŠè¯¥æé«˜ä½é˜ˆå€¼æ—¶ï¼Œå›æ’¤é£é™©å°†ç¬æ—¶æ¿€å¢ï¼Œå±äºå…¸å‹çš„â€œé¡¶éƒ¨èƒŒç¦»â€å½¢æ€ã€‚ç›®å‰è·åˆ©ç›˜å›åå‹åŠ›å·¨å¤§ï¼Œç”šè‡³å·²è§¦åŠå†å²é«˜é¢‘æŠ›å”®åŸºå› ã€‚å»ºè®®æ‰§è¡Œâ€œé˜²å¾¡æ”¶ç½‘â€ç­–ç•¥ï¼Œåˆ‡å‹¿ç›²ç›®åšå¼ˆé±¼å°¾è¡Œæƒ…ã€‚ğŸŸğŸ›‘\n\n`;
        ch += `2. ç­¹ç é˜²å¾¡è¾¹ç•Œï¼šRM ${(price * 1.05).toFixed(3)} é™„è¿‘å †ç§¯äº†å¤§é‡ä¸Šæ¡£å¥—ç‰¢ç›˜ï¼Œæˆäº¤é‡ä¸ä»·æ ¼å‘ˆç°å‡ºå¾®å°ä½†è‡´å‘½çš„èƒŒç¦»ã€‚ç»“è®ºï¼šå¤„äºé«˜ä½æ´¾å‘é˜¶æ®µï¼Œå»ºè®®åˆ†æ‰¹æ­¢ç›ˆæ’¤ç¦»ã€‚`;
      } else {
        ch += `ç›®å‰å¤„äºå…¸å‹çš„â€œä¸­è½´æ¨ªç›˜â€çŠ¶æ€ã€‚è‚¡ä»·å›´ç»•æœˆçº¿ä¸­æ¢è¿›è¡Œç±»å¸ƒæœ—è¿åŠ¨ï¼Œæ³¢åŠ¨ç‡ç»´æŒåœ¨å¥åº·åŒºé—´ã€‚æœªå‘ç°ä¸»åŠ›å¤§è§„æ¨¡è¿›åœºæˆ–æ’¤ç¦»çš„å¼‚åŠ¨è®°å½•ã€‚ç›®å‰çš„çª„å¹…éœ‡è¡ä¸»è¦æ˜¯ä¸ºäº†é€šè¿‡æ—¶é—´æ¢ç©ºé—´ï¼Œä»¥æ­¤æ¶ˆè€—ä¸Šæ–¹çš„é•¿æœŸå‡çº¿å‹åŠ›ï¼Œç­‰å¾…ä¸‹ä¸€æ­¥æ¿å—è½®åŠ¨çš„æ–¹å‘é€‰æ‹©ã€‚ğŸ±\n\n`;
        ch += `2. ç­¹ç é˜²å¾¡è¾¹ç•Œï¼šæ”¯æ’‘ä½é”å®šåœ¨ RM ${(price * 0.982).toFixed(3)}ï¼Œé˜»åŠ›ä½é”å®šåœ¨ RM ${(price * 1.03).toFixed(3)}ã€‚ç›®å‰ä¹°å–ç›˜æŒ‚å•æ¯”ä¾‹å‡è¡¡ï¼Œæœªè§åŸºå› å¼‚å¸¸ã€‚å»ºè®®ä¿æŒè€å¿ƒï¼Œç­‰å¾…é‡èƒ½çªç ´åå†è¡Œä»‹å…¥ã€‚ç»“è®ºï¼šè¶‹åŠ¿å¤„äºé€‰æ‹©æœŸã€‚`;
      }

      setReport(ch);
      setIsAnalyzing(false);
    }, 4000);
  };

  const shareToWhatsApp = () => {
    const price = manualPrice.toFixed(3);
    const content = report || `${selectedStock.name} ç›®å‰æŠ¥ RM ${price}ï¼Œæ­£åœ¨æœˆåº¦åŸºå› å¯¹é½ä¸­ã€‚`;
    const message = `*ğŸ“Š MMA æ·±åº¦é‡åŒ–ç ”æŠ¥*\n--------------------------------\n*è‚¡ç¥¨:* ${selectedStock.name} (${selectedStock.code}.KL)\n*æ¿å—:* ${selectedStock.sector}\n*ä»·æ ¼:* RM ${price}\n*RSI:* ${currentRSI}\n--------------------------------\n\n*ã€é‡åŒ–åˆ†æç®€æŠ¥ã€‘*\n${content}\n\n_â€”â€” æ•°æ®ç”± Money & Max Analyst è”æ‰‹æ ¡å‡† ğŸ‘¨â€ğŸ’»ğŸ±_`;
    window.open(`https://wa.me/?text=${encodeURIComponent(message)}`, '_blank');
  };

  const filteredSTOCKS = useMemo(() => {
    return BURSA_DB.filter(s => (s.name.toLowerCase().includes(query.toLowerCase()) || s.code.includes(query)) && (activeSector === 'å…¨éƒ¨' || s.sector === activeSector));
  }, [query, activeSector]);

  return (
    <div className="flex flex-col h-screen bg-[#f8fafc] text-slate-900 font-sans overflow-hidden">
      
      {/* é¡¶éƒ¨å¯¼èˆª */}
      <nav className="bg-white border-b border-slate-200 shrink-0 z-50 shadow-sm">
        <div className="px-4 py-2 md:px-6 md:py-3 flex flex-col md:flex-row md:items-center justify-between gap-3">
          <div className="flex items-center justify-between w-full md:w-auto">
            <div className="flex items-center gap-2">
              <div className="bg-blue-600 p-1.5 rounded-lg text-white shadow-md"><TrendingUp size={18} /></div>
              <div>
                <h1 className="font-extrabold text-base md:text-lg tracking-tighter leading-none uppercase">MMA ç»ˆç«¯</h1>
                <p className="text-[9px] text-slate-400 font-bold uppercase tracking-widest">Money & Max Analyst</p>
              </div>
            </div>
            <div className="md:hidden text-[10px] font-black text-blue-600 uppercase">MMA DB Active ğŸ‘¨â€ğŸ’»</div>
          </div>

          <div className="flex items-center gap-2 flex-1 w-full">
            <div className="relative flex-1">
              <Search className="absolute left-3 top-2.5 text-slate-400" size={16} />
              <input className="w-full bg-slate-100 border-none rounded-xl pl-9 pr-4 py-2 text-sm focus:ring-1 focus:ring-blue-500 outline-none transition-all" placeholder="è¾“å…¥ä»£ç æˆ–åç§° (å¦‚ 1155, MAYBANK)..." value={query} onChange={(e) => setQuery(e.target.value)} />
            </div>
            <div className="hidden lg:block text-[11px] font-bold text-slate-500 bg-slate-100 px-3 py-2 rounded-xl">
              {dateStr}
            </div>
          </div>
        </div>

        {/* é€‰è‚¡é¢æ¿ */}
        <div className="px-2 py-2 flex items-center gap-2 overflow-x-auto scrollbar-hide bg-slate-50 border-t border-slate-100">
          <div className="flex items-center gap-1.5 px-2">
            {SECTORS.map(s => (
              <button key={s} onClick={() => setActiveSector(s)} className={`whitespace-nowrap px-3 py-1.5 rounded-lg text-[9px] font-black transition-all ${activeSector === s ? 'bg-slate-900 text-white shadow-sm' : 'bg-white text-slate-400 border border-slate-200'}`}>{s}</button>
            ))}
          </div>
          <div className="w-px h-4 bg-slate-200 shrink-0 mx-1"></div>
          <div className="flex gap-2 pr-4 min-h-[44px]">
            {filteredSTOCKS.map(s => (
              <button key={s.code} onClick={() => { setSelectedStock(s); setManualPrice(s.price); setReport(null); }} className={`stock-card flex items-center gap-2 p-1.5 pr-3 rounded-xl shrink-0 ${selectedStock.code === s.code ? 'active-card' : 'bg-white/60'}`}>
                <div className={`w-1 h-6 rounded-full ${manualPrice >= s.price ? 'bg-emerald-500' : 'bg-rose-500'}`}></div>
                <div className="text-left leading-none"><p className="text-[10px] font-extrabold text-slate-900 tracking-tight">{s.name}</p><p className="text-[8px] text-slate-400 font-mono">{s.code}</p></div>
              </button>
            ))}
          </div>
        </div>
      </nav>

      {/* ä¸»ä½“ */}
      <main className="flex-1 overflow-y-auto p-4 md:p-6 space-y-6 scrollbar-hide">
        <div className="max-w-7xl mx-auto space-y-6">
          
          {/* æŒ‡æ ‡é¢æ¿ */}
          <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4">
            <div className="bg-white p-5 rounded-3xl shadow-sm border border-slate-100">
              <div className="flex items-center justify-between mb-2">
                <span className="text-slate-400 text-[10px] font-black uppercase flex items-center gap-1"><Zap size={12} className="text-amber-500" /> MMA ç²¾å‡†ä»·</span>
                <span className="text-[9px] font-bold text-slate-400 uppercase tracking-tighter">Bursa Live</span>
              </div>
              <div className="flex items-baseline gap-2">
                <span className="text-3xl font-black tracking-tighter leading-none">RM {manualPrice.toFixed(3)}</span>
                <span className={`text-[10px] font-bold ${manualPrice >= selectedStock.price ? 'text-emerald-500' : 'text-rose-500'}`}>{manualPrice >= selectedStock.price ? '+' : ''}{(((manualPrice - selectedStock.price)/selectedStock.price)*100).toFixed(2)}%</span>
              </div>
            </div>

            <div className="bg-white p-5 rounded-3xl shadow-sm border border-slate-100">
              <span className="text-slate-400 text-[10px] font-black uppercase flex items-center gap-1 mb-2"><BarChart3 size={12} className="text-blue-500" /> Quant RSI</span>
              <div className="flex items-center justify-between">
                <span className="text-3xl font-black tracking-tighter text-blue-600 leading-none">{currentRSI}</span>
                <div className="flex-1 ml-4 bg-slate-100 h-1.5 rounded-full overflow-hidden">
                  <div className={`h-full transition-all duration-700 ${currentRSI < 35 ? 'bg-emerald-500' : (currentRSI > 65 ? 'bg-rose-500' : 'bg-blue-600')}`} style={{width: `${currentRSI}%`}}></div>
                </div>
              </div>
            </div>

            <div className="bg-white p-5 rounded-3xl shadow-sm border border-slate-100 sm:col-span-2 flex items-center justify-between">
              <div className="flex flex-col">
                <span className="text-slate-400 text-[10px] font-black uppercase flex items-center gap-1 mb-1 tracking-tight">
                  <ShieldCheck size={12} className="text-emerald-500" /> 30D ç­–ç•¥è¯„çº§
                </span>
                <span className={`text-2xl font-black tracking-tighter ${statusInfo.color} leading-none tracking-tight`}>{statusInfo.label}</span>
              </div>
              <div className={`${statusInfo.bg} px-4 py-2 rounded-2xl hidden sm:block`}>
                <span className={`text-[10px] font-black uppercase tracking-widest ${statusInfo.color}`}>MMA Accurate</span>
              </div>
            </div>
          </div>

          <div className="grid grid-cols-1 lg:grid-cols-3 gap-6">
            {/* å›¾è¡¨ */}
            <div className="lg:col-span-2 bg-white p-6 md:p-8 rounded-[2.5rem] shadow-sm border border-slate-100 flex flex-col min-h-[400px]">
              <div className="flex items-center justify-between mb-6">
                <div>
                  <h3 className="font-black text-lg md:text-xl text-slate-800 tracking-tight">30-Day Accurate Chart</h3>
                  <p className="text-[10px] text-slate-400 font-bold uppercase tracking-widest">{selectedStock.name} ç²¾å‡†å¯¹é½æ¨¡å‹</p>
                </div>
              </div>
              <div className="flex-1 w-full relative">
                <ResponsiveContainer width="100%" height="100%">
                  <AreaChart data={historyData}>
                    <defs>
                      <linearGradient id="colorPrice" x1="0" y1="0" x2="0" y2="1">
                        <stop offset="5%" stopColor="#3b82f6" stopOpacity={0.1}/>
                        <stop offset="95%" stopColor="#3b82f6" stopOpacity={0}/>
                      </linearGradient>
                    </defs>
                    <CartesianGrid strokeDasharray="3 3" vertical={false} stroke="#f1f5f9" />
                    <XAxis dataKey="date" hide />
                    <YAxis domain={['auto', 'auto']} hide />
                    <Tooltip contentStyle={{ borderRadius: '16px', border: 'none', boxShadow: '0 10px 25px rgba(0,0,0,0.1)' }} formatter={(val) => [`RM ${val}`, 'å¯¹é½ä»·']} />
                    <Area type="monotone" dataKey="price" stroke="#2563eb" strokeWidth={3.5} fillOpacity={1} fill="url(#colorPrice)" isAnimationActive={false} />
                  </AreaChart>
                </ResponsiveContainer>
              </div>
            </div>

            {/* ç­–ç•¥é¢æ¿ */}
            <div className="bg-[#0f172a] text-white p-6 md:p-8 rounded-[2.5rem] shadow-2xl flex flex-col relative overflow-hidden">
              <div className="relative z-10 flex flex-col h-full">
                <div className="flex items-center gap-3 mb-6">
                  <div className="w-12 h-12 bg-blue-600 rounded-2xl flex items-center justify-center text-2xl shadow-lg shadow-blue-500/20">ğŸ±</div>
                  <div>
                    <h4 className="font-black text-lg leading-none">MMA ç­–ç•¥ä¸­å¿ƒ</h4>
                    <p className="text-[10px] text-blue-400 font-bold uppercase mt-1 tracking-tighter">Independent Deep Analysis</p>
                  </div>
                </div>

                <div className="mb-4">
                  <div className="flex gap-2">
                    <input 
                      type="number" 
                      step="0.001"
                      className="flex-1 bg-white/10 border border-white/20 rounded-xl px-4 py-3 text-white font-mono font-bold text-sm outline-none focus:border-blue-500 transition-all placeholder:text-slate-500" 
                      placeholder="æ ¡å‡†æˆäº¤ä»· Price..."
                      value={manualPrice}
                      onChange={(e) => {
                        const val = parseFloat(e.target.value);
                        setManualPrice(isNaN(val) ? 0 : val);
                        setReport(null);
                      }}
                    />
                    <button onClick={() => setRefreshKey(prev => prev + 1)} className="bg-blue-600 hover:bg-blue-500 px-4 rounded-xl transition-all active:scale-95 shadow-lg shadow-blue-600/30">
                      <RefreshCw size={18} />
                    </button>
                  </div>
                </div>
                
                {/* ç®€æŠ¥æ¡† */}
                <div className="flex-1 bg-white/5 backdrop-blur-xl rounded-2xl p-5 mb-6 text-xs leading-relaxed text-slate-300 shadow-inner overflow-y-auto scrollbar-hide border border-white/5 max-h-[320px] md:max-h-none">
                  {isAnalyzing ? (
                    <div className="flex flex-col items-center justify-center h-full gap-4 py-8">
                      <Cpu className="animate-spin text-blue-400" size={32} />
                      <p className="font-bold text-blue-400 animate-pulse uppercase tracking-widest">æ­£åœ¨è¿›è¡Œé‡åŒ–æ‰«æ...</p>
                    </div>
                  ) : report ? (
                    <div className="space-y-4">
                      <div className="p-3 bg-white/5 rounded-xl border border-white/10">
                        <h5 className="text-white font-bold mb-3 flex items-center gap-2">
                          <span className="w-1 h-3 bg-blue-500 rounded-full"></span> æ·±åº¦é‡åŒ–ç®€æŠ¥ (ä¸­æ–‡)
                        </h5>
                        <div className="text-slate-200 whitespace-pre-wrap leading-relaxed">{report}</div>
                      </div>
                    </div>
                  ) : (
                    <div className="flex flex-col items-center justify-center h-full text-center text-slate-500 opacity-60 px-4">
                      <p>MMA æ•°æ®åº“å·²é”å®šæœ€æ–°æ ‡çš„ã€‚</p>
                      <p className="mt-2 text-[11px]">è¯·è¾“å…¥æœ€æ–°ä»·ä½ï¼Œæ‰§è¡Œåˆ†æè·å–ç®€æŠ¥ã€‚</p>
                    </div>
                  )}
                </div>

                <div className="grid grid-cols-1 gap-3">
                  <button 
                    disabled={isAnalyzing}
                    onClick={runAnalysis}
                    className="w-full bg-white text-slate-900 font-black py-4 rounded-2xl transition-all flex items-center justify-center gap-2 active:scale-95 text-sm shadow-xl disabled:opacity-50"
                  >
                    {isAnalyzing ? <RefreshCw className="animate-spin" size={18} /> : <Target size={18} />}
                    <span>MMAåˆ†æç®€æŠ¥</span>
                  </button>
                  <button onClick={shareToWhatsApp} className="w-full whatsapp-btn text-white font-black py-4 rounded-2xl transition-all flex items-center justify-center gap-2 active:scale-95 text-sm shadow-lg shadow-green-500/10">
                    <MessageCircle size={18} /> è½¬å‘è‡³ WhatsApp
                  </button>
                </div>
              </div>
            </div>
          </div>

          {/* åº•æ  */}
          <div className="bg-white p-6 rounded-3xl border border-slate-100 flex items-center justify-between shadow-sm">
            <div className="flex flex-col">
              <span className="text-[10px] font-black text-slate-400 uppercase mb-1 tracking-widest">Bursa Stock Database</span>
              <span className="text-sm font-black text-slate-700">{selectedStock.sector} â€¢ {selectedStock.name} ({selectedStock.code})</span>
            </div>
            <div className="flex items-center gap-2 bg-slate-50 px-4 py-2 rounded-xl border border-slate-100">
              <CheckCircle className="text-emerald-500" size={16} />
              <span className="text-[10px] font-bold text-slate-400 uppercase tracking-tight tracking-tight">MMA æ•°æ®åº“åŒæ­¥å®Œæˆ</span>
            </div>
          </div>
        </div>
      </main>
    </div>
  );
};

export default App;
